<!-- Copyright (C) 2016 Linagora

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>. -->

<div class="page-workspaces">
  <md-toolbar align="start" color="primary">
    <app-toggle-sidenav></app-toggle-sidenav>
    <span>Workspaces</span>

    <span flex></span>

    <button md-icon-button [md-menu-trigger-for]="menu">
      <md-icon>more_vert</md-icon>
    </button>

    <md-menu x-position="before" #menu="mdMenu">
      <button md-menu-item [routerLink]="['/cockpit', '404']">
        Overview
      </button>
      <button md-menu-item>
        Operation
      </button>
      <button md-menu-item>
        Config
      </button>
      <button md-menu-item>
        Flow
      </button>
      <button md-menu-item>
        Monitor
      </button>
      <button md-menu-item>
        Log
      </button>
      <button md-menu-item>
        User
      </button>
    </md-menu>
  </md-toolbar>

  <div class="bkg-primary-card">
    <md-card class="central-content" layout="column">
      <md-card-header layout-margin layout-padding>
        <md-card-title>
          Workspaces
          <md-progress-circle *ngIf="minimalWorkspaces.fetchingWorkspaces" mode="indeterminate"></md-progress-circle>
        </md-card-title>
        <md-card-subtitle>Select the workspace you want to work with</md-card-subtitle>
      </md-card-header>

      <div class="pnl-workspace-img">
        <img md-card-image src="assets/img/workspace.png">
        <button
          md-mini-fab
          class="btn-show-panel-add-workspace"
          *ngIf="minimalWorkspaces && minimalWorkspaces.minimalWorkspaces.length > 0"
          (click)="toggleAddPanel()"
        >
          <md-icon class="md-24" *ngIf="!addingWorkspace">add</md-icon>
          <md-icon class="md-24" *ngIf="addingWorkspace">clear</md-icon>
        </button>
      </div>

      <md-card-content layout-margin *ngIf="minimalWorkspaces">
        <p *ngIf="!minimalWorkspaces.fetchingWorkspaces && minimalWorkspaces.minimalWorkspaces.length === 0">
          You don't have any workspace.
        </p>

        <form
          [hidden]="minimalWorkspaces.fetchingWorkspaces || (!addingWorkspace && minimalWorkspaces.minimalWorkspaces.length !== 0)"
          #addWorkspaceForm="ngForm"
          (ngSubmit)="addWorkspace(addWorkspaceForm.value.name)"
        >
          <div layout="row" layout-margin layout-padding layout-align="start center">
            <md-input color="primary" #nameInput [(ngModel)]="name"
                      name="name" placeholder="Workspace's name" [disabled]="minimalWorkspaces.addingWorkspace">
            </md-input>
            <button [class.color-primary-bold]="minimalWorkspaces.addingWorkspace" md-raised-button type="submit"
                    [disabled]="minimalWorkspaces.addingWorkspace">
              Add workspace
              <md-progress-circle *ngIf="minimalWorkspaces.addingWorkspace" mode="indeterminate"></md-progress-circle>
            </button>
          </div>
        </form>

        <md-nav-list>
          <md-list-item *ngFor="let minimalWorkspace of minimalWorkspaces.minimalWorkspaces"
                        (click)="selectWorkspace(minimalWorkspace.id)">
            <h3 md-line [class.color-primary-bold]="workspace.id === minimalWorkspace.id">
              {{ minimalWorkspace.name }}

              <md-progress-circle
                *ngIf="minimalWorkspaces.fetchingWorkspaceWithId === minimalWorkspace.id"
                mode="indeterminate">
              </md-progress-circle>
            </h3>

            <p md-line>
              <span class="workspace-used-by">
                <span *ngIf="minimalWorkspace.usedBy.length === 0">
                  You're the only one to use this workspace
                </span>

                <span *ngIf="minimalWorkspace.usedBy.length >= 1">
                  Workspace also used by
                  <span *ngIf="minimalWorkspace.usedBy.length === 1">
                    {{ minimalWorkspace.usedBy }}
                  </span>

                  <span *ngIf="minimalWorkspace.usedBy.length > 1">
                    {{ minimalWorkspace.usedBy.slice(0, - 1).join(', ') }}
                    and
                    {{ minimalWorkspace.usedBy.slice(-1) }}
                  </span>
                </span>
              </span>
            </p>
          </md-list-item>
        </md-nav-list>

      </md-card-content>

    </md-card>
  </div>

</div>
