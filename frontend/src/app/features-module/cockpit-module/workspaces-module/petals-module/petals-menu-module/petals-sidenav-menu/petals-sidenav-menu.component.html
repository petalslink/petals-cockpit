<!-- Copyright (C) 2016 Linagora

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>. -->

<div class="petals-component">
  <button
    md-mini-fab
    class="import-bus"
    color="primary"
    md-tooltip="Import a bus"
    tooltip-position="below"
    (click)="closeSidenavMobile()"
    [routerLink]="['/cockpit', 'workspaces', workspace.id, 'petals', 'bus', 'import']"
  >
    <md-icon class="md-24">add</md-icon>
  </button>

  <md-input
    class="search"
    placeholder="Search"
    [(ngModel)]="workspace.searchPetals"
    (ngModelChange)="search(workspace.searchPetals)"
    [disabled]="workspaceNotComputed.buses.length === 0 && workspaceNotComputed.busesInProgress.length === 0"
  >
    <span md-suffix>
      <md-icon>search</md-icon>
    </span>
  </md-input>

  <div *ngIf="workspace.searchPetals !== '' && workspace.buses.length === 0" class="info no-bus">
    The workspace "<b><i>{{workspace.name}}</i></b>" doesn't match any bus, container, component or SU with a name containing "<b><i>{{ workspace.searchPetals }}</i></b>".
  </div>

  <div *ngIf="workspace.searchPetals === '' && workspaceNotComputed.buses.length === 0 && workspaceNotComputed.busesInProgress.length === 0" class="info no-bus">
    The workspace "<b><i>{{workspace.name}}</i></b>" doesn't have any bus or bus in progress.

    <div span class="info-import-bus">You may want to <a [routerLink]="['/cockpit', 'workspaces', workspace.id, 'petals', 'bus', 'import']">import</a> one.</div>
  </div>

  <md-nav-list dense *ngIf="workspace && workspace.busesInProgress && workspace.busesInProgress.length > 0" class="buses-in-progress">
    <h3 md-subheader>In progress</h3>
    <a
      md-list-item
      *ngFor="let bus of workspace.busesInProgress"
      [routerLink]="['/', 'cockpit', 'workspaces', workspace.id, 'petals', 'bus', bus.id]"
    >
      <div class="link-content">
        <div class="import-state">
          <div *ngIf="bus.importError" class="state-error">
            <md-icon class="md-24">warning</md-icon>
          </div>
          <div *ngIf="!bus.importError" class="state-pending">
            <md-progress-circle mode="indeterminate"></md-progress-circle>
          </div>
        </div>

        <div class="ip">
          {{ bus.config.ip }}
        </div>
      </div>
    </a>
  </md-nav-list>

  <app-buses-menu
    *ngIf="workspace && workspace.buses"

    [workspace]="workspace"
    [buses]="workspace.buses"
    [search]="workspace.searchPetals"

    [idWorkspaceSelected]="workspace.id"
    [idBusSelected]="workspace.selectedBusId"
    [idContainerSelected]="workspace.selectedContainerId"
    [idComponentSelected]="workspace.selectedComponentId"
    [idServiceUnitSelected]="workspace.selectedServiceUnitId"
  >
  </app-buses-menu>
</div>
