<!-- Copyright (C) 2016 Linagora

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>. -->

<div class="page-import-bus">
  <md-toolbar color="primary" *ngIf="!importing">
    <app-toggle-sidenav></app-toggle-sidenav>
    <span>Petals</span>
    <md-icon>chevron_right</md-icon>
    <span class="color-accent-bold">Import a bus</span>
  </md-toolbar>

  <div class="bkg-primary-card">
    <md-card layout-align="center center" class="central-content list-element" layout-xs="column">
      <md-card-content>

        <form #formImportBus="ngForm" (ngSubmit)="importBus(formImportBus.value)">
          <h3 md-subheader align="start" class="color-primary list-title">Description :</h3>

          <div *ngIf="newBus.importError" class="error">
            <b>Import failed with error :</b>
            <p>"{{ newBus.importError }}"</p>
          </div>

          <div
            layout-xs="column"
            layout-margin
            layout-padding
          >
            <div
              layout-gt-xs="row"
              flex-gt-xs
              layout-align="space-between center"
            >
              <md-input
                #ipInput
                type="text"
                flex-gt-xs="45"
                [(ngModel)]="newBus.config.ip"
                name="ip"
                placeholder="IP"
                [disabled]="(workspace.importingBus || importing) && !newBus.importError">
              </md-input>

              <md-input
                type="number"
                flex-gt-xs="45"
                [(ngModel)]="newBus.config.port"
                name="port"
                placeholder="Port"
                [disabled]="(workspace.importingBus || importing) && !newBus.importError">
              </md-input>
            </div>

            <div
              layout-gt-xs="row"
              flex-gt-xs
              layout-align="space-between center"
            >
              <md-input
                type="text"
                flex-gt-xs="45"
                [(ngModel)]="newBus.config.login"
                name="username"
                placeholder="Username"
                [disabled]="(workspace.importingBus || importing) && !newBus.importError">
              </md-input>

              <md-input
                type="password"
                flex-gt-xs="45"
                [(ngModel)]="newBus.config.password"
                name="password"
                placeholder="Password"
                [disabled]="(workspace.importingBus || importing) && !newBus.importError">
              </md-input>
            </div>

            <div
              layout-gt-xs="row"
              flex-gt-xs
              layout-align="start center"
            >
              <md-input
                type="password"
                flex-gt-xs="45"
                [(ngModel)]="newBus.config.passphrase"
                name="passphrase"
                placeholder="Topology Passphrase"
                [disabled]="(workspace.importingBus || importing) && !newBus.importError">
              </md-input>
            </div>

            <div align="end" class="pnl-btn-import">
              <button
                class="btn-import-bus"
                md-raised-button
                color="primary"
                type="submit"
                [disabled]="(workspace.importingBus || importing) && !newBus.importError"
              >
                <span *ngIf="!workspace.importingBus && !importing && !newBus.importError">
                  Import bus
                </span>

                <span *ngIf="(workspace.importingBus || importing) && !newBus.importError">
                  Importing bus <md-progress-circle mode="indeterminate"></md-progress-circle>
                </span>
              </button>

              <button
                *ngIf="newBus.importError"
                md-raised-button
                color="primary"
                type="button"
                [disabled]="newBus.removing"
                (click)="removeBus(newBus.id)"
              >
                Discard<span *ngIf="newBus.removing">ing</span>

                <md-progress-circle *ngIf="newBus.removing" mode="indeterminate"></md-progress-circle>
              </button>
            </div>
          </div>
        </form>

      </md-card-content>
    </md-card>
  </div>
</div>
