<!-- Copyright (C) 2017-2020 Linagora

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>. -->

  <div fxLayout="column" fxFlexFill class="wrapper-content">
    <div fxLayout="column" fxFlex class="content">
      <div *ngIf="sharedLibrary$ | async as sl" fxLayout="column" fxLayoutGap="20px">

        <mat-card fxFlex class="card-sl-infos">
          <mat-card-title fxLayout="row">
            <span fxFlex class="sl-name light-bold">About {{ sl.name }}</span>
            <mat-icon color="primary">info_outline</mat-icon>
          </mat-card-title>

          <div fxLayout="row" fxLayoutAlign="start center">
            <mat-card-header fxFlex>
              <mat-card-title>Version</mat-card-title>
              <mat-card-subtitle fxLayoutAlign="start center" class="sl-version">
                {{ sl.version }}
              </mat-card-subtitle>
            </mat-card-header>
          </div>
        </mat-card>

        <mat-card fxFlex class="card-components">
          <mat-card-title fxLayout="row">
            <span fxFlex class="light-bold">Components</span>
            <mat-icon color="primary">view_list</mat-icon>
          </mat-card-title>

          <mat-card-content class="margin-top-x1 components-content">
            <mat-nav-list *ngIf="sl.components.length !== 0; else noComponent" dense fxLayout="column" class="padding-top-x1">
              <div *ngFor="let component of sl.components; trackBy:trackByComponent" fxLayout="row" fxLayoutAlign="start center">
                <a
                  mat-raised-button
                  color="primary"
                  [routerLink]="['/workspaces', (workspaceId$ | async), 'petals', 'components', component.id]"
                  class="component"
                >
                  <div fxFlex fxLayout="row" fxLayoutAlign="start center">
                    <span class="component-name margin-right-x1">{{ component.name }}</span>
                    <mat-icon svgIcon="goto" fxLayoutAlign="center center" class="icon-x1"></mat-icon>
                  </div>
                </a>
              </div>
            </mat-nav-list>

            <ng-template #noComponent>
              <app-message
                type="info"
                msg="This shared library isn't used by any component."
                [isClosable]="false"
                class="info-sl-no-component"
              ></app-message>
            </ng-template>
          </mat-card-content>
        </mat-card>

        <mat-card fxFlex class="shared-library-lifecycle">
          <mat-card-title fxLayout="row">
            <span fxFlex class="light-bold">Lifecycle</span>
            <mat-icon color="primary">play_for_work</mat-icon>
          </mat-card-title>

          <mat-card-content fxLayout="row wrap" class="margin-top-x1">
            <span class="padding-bottom-x1">
              <button
                mat-raised-button
                (click)="unload(sl.id)"
                [disabled]="sl.isFetchingDetails || sl.isUpdatingState || sl.components.length > 0"
                class="color-primary text-upper margin-right-x1"
              >
                <mat-icon
                  *ngIf="sl.components.length > 0"
                  matTooltip="To unload a shared-library, all components that use it should be unloaded first"
                  matTooltipPosition="above"
                >
                  info
                </mat-icon>
                <mat-icon *ngIf="sl.components.length === 0">remove_circle_outline</mat-icon>
                <span>Unload</span>
              </button>
            </span>
          </mat-card-content>

          <app-message type="error" [msg]="sl.errorChangeState"></app-message>

        </mat-card>
      </div>
    </div>
  </div>
