<!-- Copyright (C) 2017 Linagora

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>. -->

<div fxLayout="column" fxFlex class="wrapper-content">
  <md-toolbar color="primary" class="toolbar-page-header">
    <div class="prefix-toolbar-title">
      <md-icon>edit</md-icon>
    </div>

    <h1 class="title" [ngClass.lt-md]="'margin-left-x1'">Workspace Bus Import</h1>
  </md-toolbar>

  <div class="deleted-message" *ngIf="isSelectedBus() && isSelectedBusDeleted()">
    This import has been removed
  </div>

  <div fxFlexFill fxLayout="column" class="content content-max-width">
    <div class="central-content">
    <ngx-hover-opacity [isHoverVisible]="isSelectedBus() && isSelectedBusDeleted()">
      <form formnovalidate [formGroup]="busImportForm" (ngSubmit)="onSubmit(busImportForm) && busImportForm.reset()">
        <md-card fxLayout="column">

          <md-card-title fxLayout="row">
            <span fxFlex class="text-upper">Import Details</span>
            <md-icon color="primary">archive</md-icon>
          </md-card-title>
          <md-card-subtitle *ngIf="!isStillImporting()" fxLayout="row" fxLayoutAlign="start center">
            <md-icon color="primary">info</md-icon>
            <span class="color-primary">After completing all the required fields, click <b>IMPORT</b>.</span>
          </md-card-subtitle>

          <md-card-content>
            <div fxLayout="row" fxLayout.xs="column" fxLayoutWrap fxLayoutGap="10px">
              <!-- To have more deterministic behavour, we should be able to set 50 to say 2 per line
                   See: https://github.com/angular/flex-layout/issues/235 -->
              <div fxFlex="47" fxFlex.xs="100" class="margin-top-x1">
                <md-form-field fxFill>
                  <input type="text" mdInput appFocusInputIfLargeScreen placeholder="IP or hostname" formControlName="ip" required [errorStateMatcher]="createFormErrorStateMatcher">
                  <span mdPrefix><md-icon color="primary">star_half</md-icon></span>
                  <md-error *ngIf="formErrors.ip">
                    {{ formErrors.ip }}
                  </md-error>
                </md-form-field>
              </div>

              <div fxFlex="47" fxFlex.xs="100" class="margin-top-x1">
                <md-form-field fxFill>
                  <input type="text" mdInput placeholder="Port" formControlName="port" required [errorStateMatcher]="createFormErrorStateMatcher">
                  <span mdPrefix><md-icon color="primary">settings_ethernet</md-icon></span>
                  <md-error *ngIf="formErrors.port">
                    {{ formErrors.port }}
                  </md-error>
                </md-form-field>
              </div>

              <div fxFlex="47" fxFlex.xs="100" class="margin-top-x1">
                <md-form-field fxFill>
                  <input type="text" mdInput placeholder="Username" formControlName="username" required [errorStateMatcher]="createFormErrorStateMatcher">
                  <span mdPrefix><md-icon color="primary">person</md-icon></span>
                  <md-error *ngIf="formErrors.username">
                    {{ formErrors.username }}
                  </md-error>
                </md-form-field>
              </div>

              <div fxFlex="47" fxFlex.xs="100" class="margin-top-x1">
                <md-form-field fxFill>
                  <input type="password" mdInput placeholder="Password" formControlName="password" required [errorStateMatcher]="createFormErrorStateMatcher">
                  <span mdPrefix><md-icon color="primary">vpn_key</md-icon></span>
                  <md-error *ngIf="formErrors.password">
                    {{ formErrors.password }}
                  </md-error>
                </md-form-field>
              </div>

              <div fxFlex="47" fxFlex.xs="100" class="margin-top-x1">
                <md-form-field fxFill>
                  <input type="password" mdInput placeholder="Topology passphrase" formControlName="passphrase" required [errorStateMatcher]="createFormErrorStateMatcher">
                  <span mdPrefix><md-icon color="primary">security</md-icon></span>
                  <md-error *ngIf="formErrors.passphrase">
                    {{ formErrors.passphrase }}
                  </md-error>
                </md-form-field>
              </div>
            </div>
          </md-card-content>

          <md-card-content fxLayout="column" *ngIf="getError() as error" class="error">
            <div fxLayout="row" fxLayoutAlign="start center">
              <md-icon color="warn">warning</md-icon>
              <span class="error-details">{{ error }}</span>
            </div>
          </md-card-content>

          <md-card-actions class="padding-right-x1 margin-bottom-x1" fxLayoutAlign="end center">
            <button
              md-raised-button
              color="accent"
              type="button"
              *ngIf="isNewBus() && !newBusData().isImporting"
              class="btn-clear-form margin-right-x1 text-upper"
              (click)="reset()">
              <md-icon>clear_all</md-icon>
              <span class="clear-name">Clear</span>
            </button>
            <button
              md-raised-button
              color="warn"
              type="button"
              *ngIf="isSelectedBus()"
              (click)="discardSelectedBus()"
              [disabled]="selectedBus().isRemoving"
              class="margin-right-x1 btn-discard-form text-upper">
              <ng-template [ngIf]="selectedBus().importError" [ngIfElse]="cancel">
                <md-icon>remove_circle</md-icon><span class="discard-name">Discard</span>
              </ng-template>
              <ng-template #cancel>
                <md-icon>cancel</md-icon><span class="cancel-name">Cancel</span>
              </ng-template>
            </button>
            <button
              md-raised-button
              color="primary"
              type="submit"
              class="btn-import-form text-upper"
              [disabled]="busImportForm.invalid || isSelectedBus() || (isNewBus() && newBusData().isImporting)">
              <span *ngIf="isStillImporting(); else canImport" fxFill fxLayout="row" fxLayoutAlign="center center">
                Importing <md-spinner></md-spinner>
              </span>
              <ng-template #canImport>
                <md-icon>import_export</md-icon><span class="import-name">Import</span>
              </ng-template>
            </button>
          </md-card-actions>

        </md-card>
      </form>
    </ngx-hover-opacity>
    </div>
  </div>
</div>
