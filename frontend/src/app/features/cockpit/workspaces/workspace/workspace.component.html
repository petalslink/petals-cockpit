<!-- Copyright (C) 2017 Linagora

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>. -->

<div *ngIf="workspace$ | async as workspace" fxLayout="column" fxFill class="wrapper-content">
  <md-toolbar>
    <div class="prefix-toolbar-title">
      <md-icon color="primary" *ngIf="!workspace.isFetchingDetails">grade</md-icon>
      <md-spinner *ngIf="workspace.isFetchingDetails"></md-spinner>
    </div>

    <span class="title" fxFlex>{{ workspace.name }}</span>

    <button color="warn" type="button" class="btn-delete-wks" (click)="openDeletionDialog()" md-mini-fab mdTooltip="Delete the workspace"
      mdTooltipPosition="below" [disabled]="workspace.isRemoving">
      <md-icon>delete</md-icon>
    </button>
  </md-toolbar>

  <div fxFill fxLayout="column" class="content content-max-width">
    <div class="central-content">

      <h3 class="color-primary-light-bold margin-top-x2">Whiteboard</h3>
      <md-card>
        <md-card-content>

          <div fxLayout="row" *ngIf="!isEditingDescription; else descriptionEdit" class="workspace-description">
            <button class="btn-edit" color="primary" type="button" (click)="editDescription()" md-mini-fab mdTooltip="Edit" mdTooltipPosition="below">
              <md-icon>edit</md-icon>
            </button>
            <div class="info margin-right-x1" fxFlex [innerHTML]="workspace.description | MarkdownToHtml"></div>
          </div>

          <ng-template #descriptionEdit>
            <div fxLayout="column" *ngIf="description !== null" class="workspace-description-edit">
              <div fxLayout="row">
                <md-input-container fxFlex class="margin-right-x1">
                  <textarea mdInput class="description-wks" mdTextareaAutosize [disabled]="isSettingDescription"
                    [(ngModel)]="description"></textarea>
                </md-input-container>
              </div>
              <div fxLayout="row" class="warning" [innerHTML]="description | MarkdownToHtml"></div>
            </div>

            <md-card-actions align="end">
              <button class="workspace-description-edit-cancel" md-button [disabled]="isSettingDescription" (click)="cancelDescription()">Cancel</button>
              <button class="workspace-description-edit-submit" md-button [disabled]="isSettingDescription" (click)="validateDescription()"
                color="accent" md-raised-button>Submit</button>
            </md-card-actions>
          </ng-template>

        </md-card-content>
      </md-card>

      <h3 class="color-primary-light-bold margin-top-x2">User{{ (workspace.users.list.length - 1) >= 2 ? 's' : '' }}</h3>

      <md-card>
        <md-card-content>

          <div fxLayout="column" *ngIf="workspace.users.list as users" class="workspace-users">
            <div *ngIf="users.length === 1; else workspaceShared">
              <p class="users-in-workspace">You are the only one using this workspace:</p>
            </div>

            <ng-template #workspaceShared>
              <p class="users-in-workspace">{{ users.length }} people are using this workspace:</p>
            </ng-template>

            <md-list>
              <md-list-item *ngFor="let user of users">
                <app-generate-icon md-list-avatar [size]="35" [text]="user.id"></app-generate-icon>

                <h2 md-line>{{ user.id }}</h2>

                <p md-line>
                  <span>{{ user.name }}</span>
                </p>
              </md-list-item>
            </md-list>
          </div>

        </md-card-content>
      </md-card>
    </div>
  </div>
</div>
