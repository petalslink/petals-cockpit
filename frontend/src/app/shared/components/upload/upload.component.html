<!-- Copyright (C) 2017 Linagora

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>. -->

<app-mat-card-toolbar [title]="title" titleIcon="file_upload">
  <mat-card-content>
    <div *ngIf="!selectedFileInformation">
      <input
        type="file"
        name="choose-file-hidden"
        #selectFile
        [accept]="acceptedFileType"
        (change)="fileChange($event)"
      >

      <button
        class="choose-file"
        mat-button
        [disabled]="disabled"
        (click)="selectFile.click()"
      >
        Choose a file to upload
      </button>
    </div>

    <div
      class="when-selected-file"
      *ngIf="selectedFileInformation"
    >
      <div
        class="selected-file"
        fxLayout="row"
        fxLayout.lt-md="column"
        fxLayoutAlign="start center"
      >
        <span class="file-name">
          {{ selectedFileInformation.file.name }}
        </span>

        <div fxFlex.lt-md></div>

        <div
          class="edit-information"
          *ngIf="updateFileInformation"
          fxFlex
        >
          <app-mat-card-toolbar [title]="'Edit information'" titleIcon="mode_edit">
            <ng-container [ngTemplateOutlet]="updateFileInformation.templateRef"></ng-container>
          </app-mat-card-toolbar>
        </div>

        <div
          class="upload-actions"
          *ngIf="!isUploading"
          fxLayout="row"
          fxLayoutAlign="center center"
          fxLayoutGap="15px"
          [ngStyle.lt-md]="{'margin-top.px': 15}"
        >
          <button mat-mini-fab class="btn-remove-file" (click)="removeFile()">
            <mat-icon>delete</mat-icon>
          </button>

          <button mat-raised-button class="btn-upload" (click)="uploadFile()">Upload</button>
        </div>
      </div>

      <div fxLayout="column" fxLayoutAlign="center center" *ngIf="isUploading">
        <p>Uploading the file...</p>

        <mat-progress-bar
          color="primary"
          mode="determinate"
          [value]="percentage"
          >
        </mat-progress-bar>
      </div>
    </div>

    <app-message
      class="error-upload"
      type="error"
      [msg]="error"
    ></app-message>
  </mat-card-content>
</app-mat-card-toolbar>
