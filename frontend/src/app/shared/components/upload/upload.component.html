<!-- Copyright (C) 2017 Linagora

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>. -->

<!-- Material doesn't support inputs of type file -->
<!-- https://github.com/angular/material2/issues/3262 -->
<!-- https://github.com/angular/material2/issues/3758 -->
<!-- the trick here consists in hiding the input, and bind the click on a button to that input -->
<md-card fxLayout="column" class="margin-top-x1">
  <form (ngSubmit)="onDeploy.emit({file: fileToDeploy, name: changeFileName})">
    <md-card-title fxLayout="row">
      <span fxFlex class="text-upper title">{{ title }}</span>
      <md-icon color="primary">file_upload</md-icon>
    </md-card-title>

    <md-card-subtitle *ngIf="fileToDeploy" class="selected-file">Selected file:
      <b><span class="file-name">{{ fileToDeploy.name }}</span></b>
    </md-card-subtitle>

    <!-- Material doesn't support inputs of type file -->
    <!-- https://github.com/angular/material2/issues/3262 -->
    <!-- https://github.com/angular/material2/issues/3758 -->
    <!--the trick here consists in hiding the input, and bind the click on a button to that input-->
    <md-card-content class="margin-top-x2" fxLayout="column" fxLayout.gt-sm="row">
      <input #deploy class="hidden" type="file" accept=".zip" (change)="fileChange($event)" [disabled]="disabled">

      <md-input-container fxFlex *ngIf="fileToDeploy && placeholderChangeFileName" class="change-file-name">
        <input mdInput type="text" [(ngModel)]="changeFileName" name="changeFileName" [placeholder]="placeholderChangeFileName" [disabled]="changeFileName?.trim().length === 0 || disabled">
      </md-input-container>

      <div>
        <button md-button color="primary" type="button" (click)="deploy.click()" class="choose-file text-upper" [disabled]="disabled">
          <span *ngIf="!fileToDeploy; else changeFile">Choose a file to upload</span>
          <ng-template #changeFile>Change the file</ng-template>
        </button>

        <button class="text-upper deploy" md-raised-button color="accent" type="submit" *ngIf="fileToDeploy" [disabled]="disabled">
          Deploy
        </button>
      </div>
    </md-card-content>

    <md-card-content fxLayout="column" *ngIf="error" class="error error-deploy">
      <div class="title bold margin-bottom-x1">An error occurred:</div>
      <span class="message italic">{{ error }}</span>
    </md-card-content>
  </form>
</md-card>
